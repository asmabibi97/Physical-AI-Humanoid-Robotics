# 1.3 Python to ROS with `rclpy`: Your First ROS 2 Program

Now that we understand the core concepts of Nodes, Topics, and Services, let's put that knowledge into practice by writing our first ROS 2 programs using Python with the `rclpy` client library. `rclpy` provides a Pythonic interface to interact with the ROS 2 system.

## Setting Up Your ROS 2 Workspace (Briefly)

While this module doesn't cover full ROS 2 installation, to run `rclpy` examples, you would typically:

1.  **Install ROS 2**: Follow the official ROS 2 documentation for your operating system (e.g., Ubuntu, Windows). We recommend the "Humble Hawksbill" distribution.
2.  **Source the ROS 2 Environment**: `source /opt/ros/humble/setup.bash` (Linux) or `C:\dev\ros2_humble\local_setup.bat` (Windows).
3.  **Create a ROS 2 Workspace and Package**:
    ```bash
    mkdir -p ~/ros2_ws/src
    cd ~/ros2_ws/src
    ros2 pkg create --build-type ament_python my_python_pkg
    ```

## Your First ROS 2 Node: The "Talker"

Let's create a simple ROS 2 node that continuously publishes a "Hello ROS 2" message to a topic. We'll call this our "talker" node.

Create a file named `talker_node.py` inside `~/ros2_ws/src/my_python_pkg/my_python_pkg/` (you might need to create the `my_python_pkg` subdirectory within the second `my_python_pkg` folder):

```python
import rclpy
from rclpy.node import Node
from std_msgs.msg import String

class SimpleTalker(Node):

    def __init__(self):
        super().__init__('simple_talker') # Initialize the node with the name 'simple_talker'
        self.publisher_ = self.create_publisher(String, 'chatter', 10) # Create a publisher to 'chatter' topic
        timer_period = 0.5  # seconds
        self.timer = self.create_timer(timer_period, self.timer_callback) # Create a timer to call callback every 0.5s
        self.i = 0

    def timer_callback(self):
        msg = String()
        msg.data = f'Hello ROS 2: {self.i}'
        self.publisher_.publish(msg) # Publish the message
        self.get_logger().info(f'Publishing: "{msg.data}"') # Log to console
        self.i += 1

def main(args=None):
    rclpy.init(args=args) # Initialize rclpy
    simple_talker = SimpleTalker() # Create the node
    rclpy.spin(simple_talker) # Keep the node alive until it's shut down
    simple_talker.destroy_node() # Destroy the node explicitly
    rclpy.shutdown() # Shutdown rclpy

if __name__ == '__main__':
    main()
```

### Running the Talker Node

1.  **Modify `setup.py`**: Add the following to your `~/ros2_ws/src/my_python_pkg/setup.py` inside the `entry_points` dictionary:
    ```python
    entry_points={
        'console_scripts': [
            'talker = my_python_pkg.talker_node:main',
        ],
    },
    ```
2.  **Build your package**:
    ```bash
    cd ~/ros2_ws
    colcon build --packages-select my_python_pkg
    ```
3.  **Source your workspace**:
    ```bash
    source install/setup.bash
    ```
4.  **Run the node**:
    ```bash
    ros2 run my_python_pkg talker
    ```
You should see messages being published in your terminal.

## Your First ROS 2 Node: The "Listener"

Now, let's create a "listener" node that subscribes to the `chatter` topic and prints the messages it receives.

Create a file named `listener_node.py` inside `~/ros2_ws/src/my_python_pkg/my_python_pkg/`:

```python
import rclpy
from rclpy.node import Node
from std_msgs.msg import String

class SimpleListener(Node):

    def __init__(self):
        super().__init__('simple_listener') # Initialize the node with the name 'simple_listener'
        self.subscription = self.create_subscription(
            String,
            'chatter',
            self.listener_callback,
            10) # Create a subscriber to 'chatter' topic
        self.subscription  # prevent unused variable warning

    def listener_callback(self, msg):
        self.get_logger().info(f'I heard: "{msg.data}"') # Log to console

def main(args=None):
    rclpy.init(args=args) # Initialize rclpy
    simple_listener = SimpleListener() # Create the node
    rclpy.spin(simple_listener) # Keep the node alive until it's shut down
    simple_listener.destroy_node() # Destroy the node explicitly
    rclpy.shutdown() # Shutdown rclpy

if __name__ == '__main__':
    main()
```

### Running the Listener Node

1.  **Modify `setup.py`**: Add the following to your `~/ros2_ws/src/my_python_pkg/setup.py` inside the `entry_points` dictionary (next to the talker entry):
    ```python
    entry_points={
        'console_scripts': [
            'talker = my_python_pkg.talker_node:main',
            'listener = my_python_pkg.listener_node:main', # Add this line
        ],
    },
    ```
2.  **Build your package (again)**:
    ```bash
    cd ~/ros2_ws
    colcon build --packages-select my_python_pkg
    ```
3.  **Source your workspace (again)**:
    ```bash
    source install/setup.bash
    ```
4.  **Run in a new terminal**: Open a *new terminal*, source your workspace, and run:
    ```bash
    ros2 run my_python_pkg listener
    ```
You should now see the messages from the talker node appearing in the listener's terminal!

## Summary

You've just created and run your first two ROS 2 nodes using `rclpy`! You've seen how to:

*   Initialize a ROS 2 node.
*   Create a publisher to send messages to a topic.
*   Create a subscriber to receive messages from a topic.
*   Use `rclpy.spin()` to keep your node alive.

This foundational understanding of `rclpy` is crucial for developing more complex robot behaviors.
