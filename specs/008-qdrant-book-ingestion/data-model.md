# Data Model: Qdrant Book Content Ingestion with Gemini

## Entity: Book Content Chunk
- **Fields**:
  - id: string (auto-generated unique identifier)
  - text_content: string (the actual text content of the chunk)
  - source_url: string (the URL where this content originates)
  - page_path: string (relative path of the page in the Docusaurus book)
  - chunk_index: integer (position of this chunk within the page)
  - embedding_vector: array of floats (numerical representation of the text from Gemini API)
  - created_at: timestamp (when this chunk was created)
  - updated_at: timestamp (when this chunk was last updated)

- **Validation rules**:
  - text_content must not be empty
  - chunk_index must be >= 0
  - source_url must be a valid URL format
  - page_path must start with a slash and be a valid path

- **Relationships**:
  - Belongs to a single Qdrant Collection

## Entity: Embedding Vector
- **Fields**:
  - vector_id: string (identifier for this vector in Qdrant)
  - content_id: string (reference to the Book Content Chunk)
  - values: array of floats (the actual embedding values generated by Gemini API)
  - created_at: timestamp

- **Validation rules**:
  - values array must have consistent dimensions based on Gemini embedding model
  - vector_id must be unique within the collection

- **Relationships**:
  - References a single Book Content Chunk

## Entity: Qdrant Collection
- **Fields**:
  - collection_name: string (name of the Qdrant collection)
  - vector_size: integer (dimension of the embedding vectors from Gemini API)
  - distance_metric: string (cosine, euclidean, etc.)
  - created_at: timestamp
  - total_chunks: integer (number of chunks stored)

- **Validation rules**:
  - collection_name must be unique
  - vector_size must be consistent across all embeddings in the collection (determined by Gemini model)

- **Relationships**:
  - Contains multiple Embedding Vectors
  - Contains multiple Book Content Chunks (via the embedding relationship)

## Entity: Query Request
- **Fields**:
  - query_text: string (the user's question)
  - selected_text: string (optional, specific text to constrain the search to)
  - top_k: integer (number of results to return, default 5)
  - filter_params: object (optional filters for the search)

- **Validation rules**:
  - query_text must not be empty
  - top_k must be between 1 and 20

- **State transitions**:
  - Created (when request is received)
  - Processing (when searching for relevant chunks via Qdrant)
  - Response Generation (when using Gemini to generate answer)
  - Completed (when response is ready)

## Entity: Query Response
- **Fields**:
  - answer: string (the generated answer to the query using Gemini)
  - source_chunks: array (list of chunks that informed the answer)
  - confidence_score: float (confidence in the answer's accuracy)
  - processing_time: float (time taken to process the query in seconds)
  - accuracy_score: float (accuracy of the response, targeting >95%)

- **Validation rules**:
  - answer must not be empty
  - confidence_score must be between 0 and 1
  - accuracy_score must be between 0 and 1
  - source_chunks should not be empty if an answer is provided
  - accuracy_score must be >= 0.95 for successful responses

## Entity: API Key Configuration
- **Fields**:
  - qdrant_api_key: string (API key for Qdrant Cloud)
  - google_api_key: string (API key for Gemini)
  - created_at: timestamp

- **Validation rules**:
  - API keys must be stored securely in environment variables only
  - Keys must not be hardcoded in code or configuration files

- **Relationships**:
  - Referenced by Embedding Service and Qdrant Service